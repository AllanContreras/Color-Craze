# Railway production profile

# MongoDB Atlas connection - ENABLED FOR PRODUCTION
# Usa la variable de entorno MONGODB_URI configurada en Railway
spring.data.mongodb.uri=${MONGODB_URI}

# Opcional: crear índices automáticamente si las entidades usan @Indexed
spring.data.mongodb.auto-index-creation=true

# Server configuration - Railway provides PORT automatically
server.port=${PORT:8080}

# Respect X-Forwarded-* headers from Railway proxy
server.forward-headers-strategy=framework

# CORS configuration for production
app.cors.allowed-origins=${FRONTEND_URL:http://localhost:3000},https://*.railway.app,https://*.vercel.app
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
app.cors.allowed-headers=Authorization,Content-Type,X-Requested-With

# Reduce MongoDB driver logging
logging.level.org.mongodb.driver.cluster=WARN
logging.level.org.mongodb.driver.connection=WARN
logging.level.org.mongodb.driver.client=WARN

# Health checks (Mongo habilitado). Si falla la BD, el app seguirá arrancando
# pero /actuator/health reflejará el estado de Mongo
management.endpoint.health.show-details=always
management.health.defaults.enabled=true
management.health.ping.enabled=true
management.health.diskspace.enabled=true
# Desactivar Mongo y Redis en Railway para evitar health FAIL cuando servicios externos no estén listos
management.health.mongo.enabled=false
management.health.redis.enabled=false

# Feature flags
app.guest.persist=false
app.auth.persist=false

# JWT configuration
app.jwt.secret=${JWT_SECRET:defaultSecretForDevelopmentOnly123456789}
app.jwt.expiration=${JWT_EXPIRATION:86400000}

# Health check endpoint
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=always

# STOMP broker relay (enable via env when external broker is available)
colorcraze.stomp.relay.enabled=${STOMP_RELAY_ENABLED:false}
colorcraze.stomp.relay.host=${STOMP_RELAY_HOST:localhost}
colorcraze.stomp.relay.port=${STOMP_RELAY_PORT:61613}
colorcraze.stomp.relay.clientLogin=${STOMP_RELAY_CLIENT_LOGIN:guest}
colorcraze.stomp.relay.clientPasscode=${STOMP_RELAY_CLIENT_PASSCODE:guest}
colorcraze.stomp.relay.systemLogin=${STOMP_RELAY_SYSTEM_LOGIN:guest}
colorcraze.stomp.relay.systemPasscode=${STOMP_RELAY_SYSTEM_PASSCODE:guest}
colorcraze.stomp.relay.virtualHost=${STOMP_RELAY_VHOST:/}

# Redis (optional but recommended for multi-instance continuity)
spring.data.redis.url=${REDIS_URL:}
spring.data.redis.host=${REDIS_HOST:}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.username=${REDIS_USERNAME:}
spring.data.redis.password=${REDIS_PASSWORD:}
redis.ttl.seconds=${REDIS_TTL_SECONDS:86400}